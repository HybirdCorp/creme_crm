{% load i18n %}
{% load creme_core_tags %}
{% block title %}
    <table class="table_header" cellpadding="0" cellspacing="0">
        <tr>
            <td width="5%"><img src="{% creme_media_url logo %}" alt=""/></td>
            <td width="95%">
                <h1>{{title}}</h1>
            </td>
        </tr>
    </table>
{% endblock %}

{% if help_message %}
    <div class="help_box">{{help_message|linebreaks}}</div>
{% endif%}

<p>{% trans "Fields marked with * are required."%} </p>

<div id="editforms">
    {% if form.errors %}
        <script type="text/javascript">
            $(document).ready(function(){
                creme.utils.scrollTo($('.errorlist'));
            });
        </script>
    {% endif %}
    <form action="" method="POST" {% if form.is_multipart %}enctype="multipart/form-data"{% endif %}>{% csrf_token %}
        {% for hidden in form.hidden_fields %}
            {% if hidden.errors %}
                <p>{{hidden.label}}&nbsp;:&nbsp;{{hidden.errors}}{{hidden}}</p>
            {% else %}
                {{hidden}}
            {% endif %}
        {% endfor %}
        <div style="display: none; visibility: hidden;">
            {% for persist_key, persist_values in persisted.items %}
                {% for persist_value in persist_values %}
                    <input type="hidden" name="{{ persist_key }}" value="{{persist_value}}"/>
                    <input type="hidden" name="persist" value="{{ persist_key }}"/>
                {% endfor %}
            {% endfor %}
        </div>
        {% if form.non_field_errors %}
            <table class="table_detail_view ui-corner-all">
                <thead>
                    <tr>
                        <th valign="middle">{% trans "Global errors"%}</th>
                    </tr>
                </thead>
                <tbody class="collapsable">
                    <tr>
                        <td class="non_field_errors">{{form.non_field_errors}}</td>
                    </tr>
                </tbody>
            </table>
        {% endif %}

        {% block main_content %}
            {% for form_block in form.get_blocks.itervalues %}
                {% include "creme_core/generics/blockform/content.html" %}
            {% endfor %}
        {% endblock %}

        {% block submit_buttons %}
            {% if not hide_submit %}
                <div class="spacer"></div>
                <input type="submit" value="{% trans "Submit"%}" />
            {% endif %}
        {% endblock %}
    </form>
</div>

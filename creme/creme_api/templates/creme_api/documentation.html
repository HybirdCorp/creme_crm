{% extends 'creme_api/base.html' %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="//unpkg.com/swagger-ui-dist@4.5.0/swagger-ui.css" />
{% endblock %}

{% block content-right-panel %}
    <div id="swagger-ui"></div>

    <script src="//unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-bundle.js"></script>
    <script src="//unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-standalone-preset.js"></script>

    <script>
        window.onload = function() {
            var ui = SwaggerUIBundle({
                url: "{% url "creme_api__openapi_schema" %}",

                {#urls: [#}
                {#    {url: "{% url "creme_api__openapi_schema" %}", name: "Nom 1"},#}
                {#    {url: "{% url "creme_api__openapi_schema" %}", name: "Nom 2"}#}
                {#],#}
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                layout: "BaseLayout",
                {#layout: "StandaloneLayout",#}
                docExpansion: "none",
                // persistAuthorization: true,
                requestInterceptor: function(request) {
                    request.headers['X-CSRFToken'] = "{{ csrf_token }}"
                    // Do not include Authorization header when creating a token
                    if (! (request.url === "{{ creme_api__tokens_url }}" && request.method === "POST")) {
                        request.headers['Authorization'] = "{{ token_type }} " + sessionStorage.getItem("creme_api__documentation_token")
                    }
                    return request;
                },
                responseInterceptor: function(response) {
                    if (response.url === "{{ creme_api__tokens_url }}" && response.ok) {
                        sessionStorage.setItem("creme_api__documentation_token", response.body.token)
                    }
                    return response
                }
            });
            window.ui = ui;
        }
    </script>
{% endblock %}

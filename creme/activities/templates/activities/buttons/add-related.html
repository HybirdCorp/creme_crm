{% load i18n %}{% load has_perm_to from creme_core_tags %}{% has_perm_to link object as link_perm %}
{% if button.is_allowed and link_perm %}
<a class="menu_button menu-button-icon" title="{{button.description}}"
   href="{% url 'activities__create_related_activity' object.id %}?callback_url={{request.get_full_path}}{% if button.activity_type %}&activity_type={{button.activity_type}}{% endif %}">
    {{button.icon.render}}{{button.verbose_name}}
</a>
{% else %}
<span class="menu_button menu-button-icon forbidden"
      title="{% if not link_perm %}{% translate 'You are not allowed to link this entity' %}{% else %}{% translate 'You are not allowed to create an Activity' %}{% endif %}">
    {{button.icon.render}}{{button.verbose_name}}
</span>
{% endif %}

{% comment %}
{% load i18n %}{% load has_perm_to from creme_core_tags %}{% has_perm_to link object as link_perm %}
{% if has_perm and link_perm %}
    <a class="menu_button menu-button-icon" title="{{description}}" href="{% url 'activities__create_related_activity' object.id %}?callback_url={{request.path}}{% if activity_type %}&activity_type={{activity_type}}{% endif %}">
        {{icon.render}}{{verbose_name}}
    </a>
{% else %}
    <span class="menu_button menu-button-icon forbidden" title="{% translate 'forbidden' %}">
        {{icon.render}}{{verbose_name}}
    </span>
{% endif %}
{% endcomment %}
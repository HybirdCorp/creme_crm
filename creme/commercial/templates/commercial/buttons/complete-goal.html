{% load i18n creme_ctype creme_widgets %}{% load blockjsondata from creme_core_tags %}
{% if not button.rtype.enabled %}
<span class="menu_button menu-button-icon forbidden menu-button-error"
      title="{% blocktranslate with predicate=button.rtype.predicate %}The relationship type «{{predicate}}» is disabled{% endblocktranslate %}">
    {% widget_icon name='commercial' size='instance-button' label=_('Commercial Action') %}
    {% translate 'Completes a goal' %}
</span>
{% elif button.permission_error %}
<span class="menu_button menu-button-icon forbidden" title="{{button.permission_error}}">
    {% widget_icon name='commercial' size='instance-button' label=_('Commercial Action') %}
    {% translate 'Completes a goal' %}
</span>
{% else %}
{% with act_ctype='COMMERCIAL_ACT_MODEL'|ctype_for_swappable %}
<a class="menu_button menu-button-icon" title="{{button.description}}" data-action="add-relationships">
    {% widget_icon name='commercial' size='instance-button' label=_('Commercial Action') %}
    {% translate 'Completes a goal' %}
    {% blockjsondata %}{
        "data": {
            "subject_id": {{object.id}}, "rtype_id": "{{button.rtype.id}}", "ctype_id": {{act_ctype.id}}
        }
    }{% endblockjsondata %}
</a>
{% endwith %}
{% endif %}
